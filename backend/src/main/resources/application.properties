# Application Configuration
spring.application.name=Tally

# Server Configuration
# Railway injects PORT automatically. SERVER_PORT is a fallback for local dev.
server.port=${PORT:${SERVER_PORT:9090}}
server.error.include-message=always
server.error.include-stacktrace=never

# Database Configuration (PostgreSQL)
# These can be overridden via environment variables
# Using port 5434 to avoid conflicts with other local postgres instances
spring.datasource.url=${DATABASE_URL:jdbc:postgresql://localhost:5434/tally_db}
spring.datasource.username=${DATABASE_USERNAME:postgres}
spring.datasource.password=${DATABASE_PASSWORD:postgres}
spring.datasource.driver-class-name=org.postgresql.Driver

# JPA / Hibernate Configuration
# validate: Hibernate validates the schema matches entities (safe for production)
# update: Hibernate auto-updates schema (convenient for dev, dangerous for prod)
# We use Flyway instead, so we set this to 'validate'
spring.jpa.hibernate.ddl-auto=validate
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.open-in-view=false

# Flyway Configuration (Database Migrations)
# Flyway manages schema changes via versioned SQL scripts
spring.flyway.enabled=true
spring.flyway.baseline-on-migrate=true
spring.flyway.locations=classpath:db/migration

# Logging Configuration
logging.level.root=INFO
logging.level.com.tally=DEBUG
logging.level.org.springframework.web=DEBUG
logging.level.org.hibernate.SQL=DEBUG
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=TRACE

# Jackson JSON Configuration
spring.jackson.serialization.write-dates-as-timestamps=false
spring.jackson.time-zone=UTC

# JWT Configuration
# JWT_SECRET should be set via environment variable in production (minimum 256 bits)
# Generate with: openssl rand -base64 64
jwt.secret=${JWT_SECRET:changeme-default-256-bit-key-please-override-in-production}
jwt.access-token-expiration=${JWT_ACCESS_EXPIRATION:900000}
jwt.refresh-token-expiration=${JWT_REFRESH_EXPIRATION:604800000}
jwt.issuer=tally-api

# CORS Configuration
# Comma-separated list of allowed origins. Use "*" for development.
# Override in production: CORS_ALLOWED_ORIGINS=https://app.tally.com
cors.allowed-origins=${CORS_ALLOWED_ORIGINS:*}

# Spring Boot Actuator - Health and metrics endpoints
# Only expose health and info (never expose env, beans, etc. publicly)
management.endpoints.web.exposure.include=health,info
management.endpoint.health.show-details=when-authorized
management.info.env.enabled=true
info.app.name=Tally
info.app.description=Habit tracking REST API
info.app.version=1.0.0

# Springdoc OpenAPI / Swagger UI
# Access at: http://localhost:9090/swagger-ui/index.html
springdoc.swagger-ui.path=/swagger-ui
springdoc.api-docs.path=/v3/api-docs
springdoc.swagger-ui.operationsSorter=method
springdoc.swagger-ui.tagsSorter=alpha

# Request Logging (CommonsRequestLoggingFilter)
# Enabled in dev because logging.level.com.tally=DEBUG above activates it.
# In prod, root level is WARN so this won't emit logs.
logging.level.org.springframework.web.filter.CommonsRequestLoggingFilter=DEBUG
